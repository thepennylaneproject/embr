# Embr Platform - Production Environment Variables
# CRITICAL: Use secure secret management for all sensitive values

# ==============================================
# APPLICATION
# ==============================================
NODE_ENV=production
PORT=3001
API_URL=https://api.embr.app
WEB_URL=https://embr.app
MOBILE_URL=https://embr.app

# ==============================================
# DATABASE
# ==============================================
# Production PostgreSQL (Railway, Supabase, AWS RDS, etc.)
# Use connection pooling for production
DATABASE_URL="postgresql://user:password@host:port/database?schema=public&connection_limit=20&pool_timeout=10&statement_cache_size=100"
DIRECT_URL="postgresql://user:password@host:port/database?schema=public"

# Database connection pool settings
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=10000

# ==============================================
# REDIS
# ==============================================
# Production Redis (Railway, Upstash, AWS ElastiCache, etc.)
REDIS_URL=redis://default:STRONG_PASSWORD@host:port
REDIS_TLS=true

# ==============================================
# AUTHENTICATION
# ==============================================
# CRITICAL: Use strong, unique secrets generated securely
# Generate with: openssl rand -base64 64
JWT_SECRET=PRODUCTION_SECRET_MINIMUM_64_CHARS_RANDOM_STRING_CHANGE_THIS
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=PRODUCTION_REFRESH_SECRET_64_CHARS_MINIMUM_DIFFERENT_FROM_JWT
JWT_REFRESH_EXPIRES_IN=30d

# Google OAuth (Production Credentials)
GOOGLE_CLIENT_ID=production_google_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=production_google_client_secret
GOOGLE_CALLBACK_URL=https://api.embr.app/v1/auth/google/callback

# ==============================================
# AWS SERVICES
# ==============================================
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_S3_BUCKET=embr-production-uploads
AWS_S3_URL=https://embr-production-uploads.s3.amazonaws.com

# CloudFront CDN (optional but recommended)
CLOUDFRONT_DOMAIN=d111111abcdef8.cloudfront.net
CLOUDFRONT_KEY_ID=APKAXXXXXXXXXXXXXXXX
CLOUDFRONT_PRIVATE_KEY_PATH=/path/to/private-key.pem

# ==============================================
# VIDEO PROCESSING (MUX)
# ==============================================
MUX_TOKEN_ID=production_mux_token_id
MUX_TOKEN_SECRET=production_mux_token_secret
MUX_WEBHOOK_SECRET=production_mux_webhook_secret

# Mux configuration
MUX_PLAYBACK_POLICY=signed # Use signed URLs for security
MUX_MAX_RESOLUTION=1080p

# ==============================================
# PAYMENTS (STRIPE)
# ==============================================
# CRITICAL: Use live mode keys
STRIPE_SECRET_KEY=sk_live_PRODUCTION_STRIPE_SECRET_KEY
STRIPE_PUBLISHABLE_KEY=pk_live_PRODUCTION_STRIPE_PUBLISHABLE_KEY
STRIPE_WEBHOOK_SECRET=whsec_PRODUCTION_WEBHOOK_SECRET
PLATFORM_FEE_PERCENTAGE=10

# Stripe configuration
STRIPE_API_VERSION=2023-10-16
STRIPE_MAX_NETWORK_RETRIES=3

# ==============================================
# JOBS API (RELEVNT)
# ==============================================
RELEVNT_API_KEY=production_relevnt_api_key
RELEVNT_API_URL=https://api.relevnt.com/v1
RELEVNT_RATE_LIMIT=100
RELEVNT_TIMEOUT=10000

# ==============================================
# EMAIL (SendGrid, AWS SES, Postmark)
# ==============================================
# SendGrid configuration
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=apikey
SMTP_PASSWORD=SG.PRODUCTION_SENDGRID_API_KEY
EMAIL_FROM=noreply@embr.app
EMAIL_REPLY_TO=support@embr.app

# Email templates
EMAIL_TEMPLATE_PATH=/app/templates/emails

# ==============================================
# FRONTEND URLS (for CORS)
# ==============================================
ALLOWED_ORIGINS=https://embr.app,https://www.embr.app,https://api.embr.app

# ==============================================
# ANALYTICS & MONITORING
# ==============================================
# Sentry for error tracking (REQUIRED)
SENTRY_DSN=https://production_sentry_dsn@sentry.io/project_id
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# Google Analytics
NEXT_PUBLIC_GA_ID=G-PRODUCTION-ID

# DataDog (optional)
DD_API_KEY=datadog_api_key
DD_APP_KEY=datadog_app_key
DD_SITE=datadoghq.com

# ==============================================
# RATE LIMITING
# ==============================================
# Stricter limits for production
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=60
RATE_LIMIT_GLOBAL_MAX=10000

# Rate limiting per endpoint
RATE_LIMIT_AUTH=5 # Login attempts per minute
RATE_LIMIT_UPLOAD=10 # Uploads per hour
RATE_LIMIT_API=100 # API calls per minute

# ==============================================
# FILE UPLOAD LIMITS
# ==============================================
MAX_FILE_SIZE=104857600 # 100MB
MAX_VIDEO_DURATION=180 # 3 minutes
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/gif,image/webp
ALLOWED_VIDEO_TYPES=video/mp4,video/quicktime,video/x-msvideo

# ==============================================
# BULL QUEUE
# ==============================================
QUEUE_NAME=embr_production_jobs
QUEUE_PREFIX=embr_prod

# Queue concurrency
QUEUE_CONCURRENCY_VIDEO_PROCESSING=5
QUEUE_CONCURRENCY_EMAIL=10
QUEUE_CONCURRENCY_ANALYTICS=3

# ==============================================
# LOGGING
# ==============================================
LOG_LEVEL=warn # Only log warnings and errors
LOG_FORMAT=json # Structured logging for aggregation
LOG_ROTATION=daily
LOG_MAX_FILES=30

# ==============================================
# SECURITY
# ==============================================
# HTTPS enforcement
FORCE_HTTPS=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true

# Security headers (Helmet.js)
HELMET_ENABLED=true
CSP_ENABLED=true

# API keys rotation
API_KEY_ROTATION_DAYS=90

# Session security
SESSION_SECURE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# ==============================================
# PERFORMANCE
# ==============================================
# Enable compression
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6

# Cache settings
CACHE_TTL_SHORT=300 # 5 minutes
CACHE_TTL_MEDIUM=3600 # 1 hour
CACHE_TTL_LONG=86400 # 24 hours

# Database query timeout
DB_QUERY_TIMEOUT=30000 # 30 seconds

# ==============================================
# BACKUPS
# ==============================================
# Automated backup configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *" # 2 AM daily
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=embr-production-backups

# ==============================================
# FEATURE FLAGS
# ==============================================
ENABLE_SWAGGER=false # Disable in production
ENABLE_REQUEST_LOGGING=false # Use specialized logging
ENABLE_DETAILED_ERRORS=false # Don't leak internal errors

# Feature rollout
ENABLE_NEW_FEED_ALGORITHM=true
ENABLE_ADVANCED_MODERATION=true
ENABLE_VIDEO_TRANSCRIPTION=false

# ==============================================
# COMPLIANCE & LEGAL
# ==============================================
# GDPR compliance
DATA_RETENTION_DAYS=365
ENABLE_GDPR_EXPORTS=true
ENABLE_RIGHT_TO_FORGET=true

# Content moderation
AUTO_MODERATION_ENABLED=true
MANUAL_REVIEW_THRESHOLD=0.8

# ==============================================
# SCALING
# ==============================================
# Horizontal scaling settings
CLUSTER_MODE=true
WORKER_COUNT=auto # Use all CPU cores

# Load balancing
ENABLE_STICKY_SESSIONS=true

# ==============================================
# HEALTHCHECKS
# ==============================================
HEALTHCHECK_INTERVAL=30000
HEALTHCHECK_TIMEOUT=10000

# ==============================================
# PRODUCTION SECURITY CHECKLIST
# ==============================================
# □ All secrets generated with cryptographically secure random generators
# □ Secrets stored in secure secret management (Railway Secrets, AWS Secrets Manager, etc.)
# □ Database credentials rotated regularly
# □ HTTPS enforced on all endpoints
# □ Rate limiting configured appropriately
# □ Monitoring and alerting set up (Sentry, DataDog, etc.)
# □ Backup strategy tested and verified
# □ Disaster recovery plan documented
# □ Security headers configured (Helmet.js)
# □ CORS properly configured for production domains only
# □ API keys for third-party services (Stripe, Mux, etc.) use live/production keys
# □ Error messages don't leak sensitive information
# □ Database connection pooling configured
# □ CDN configured for static assets
# □ Log aggregation set up (CloudWatch, DataDog, etc.)
# □ Performance monitoring enabled (APM)
# □ WAF (Web Application Firewall) configured if using AWS/Cloudflare

# ==============================================
# NOTES
# ==============================================
# 1. NEVER commit this file with real production secrets
# 2. Use Railway Secrets, Vercel Environment Variables, or AWS Secrets Manager
# 3. Rotate all secrets regularly (every 90 days minimum)
# 4. Monitor for leaked secrets using tools like GitGuardian
# 5. Use different credentials for each environment
# 6. Enable 2FA on all service accounts
# 7. Set up alerts for unusual activity
# 8. Regular security audits and penetration testing
# 9. Keep all dependencies updated
# 10. Have incident response plan ready
